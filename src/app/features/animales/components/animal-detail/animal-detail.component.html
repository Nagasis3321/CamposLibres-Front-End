<div class="space-y-6" *ngIf="!loading && animal">
  <div class="flex items-center justify-between">
    <h2 class="text-3xl font-bold text-neutral-dark">Detalle de Animal</h2>
    <button (click)="goBack()" class="btn-secondary">
      Volver a Lista
    </button>
  </div>

  <!-- Alerta de Inconsistencia -->
  <div *ngIf="hasInconsistentData()" class="bg-red-50 border-l-4 border-red-500 p-4 rounded-md shadow-md">
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
      </div>
      <div class="ml-3 flex-1">
        <h3 class="text-sm font-bold text-red-800 mb-1">DATOS INCONSISTENTES</h3>
        <p class="text-sm text-red-700">{{ getInconsistencyMessage() }}</p>
        <p class="text-xs text-red-600 mt-2">
           <strong>Sugerencia:</strong> Edita este animal para corregir el tipo o el sexo.
        </p>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Informaci贸n B谩sica -->
    <div class="card">
      <h3 class="text-xl font-semibold mb-4 text-neutral-dark">Informaci贸n B谩sica</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Caravana</label>
          <p class="text-lg text-gray-900">{{ animal.caravana || 'N/A' }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Tipo de Animal</label>
          <p class="text-lg text-gray-900">{{ animal.tipoAnimal }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Pelaje</label>
          <p class="text-lg text-gray-900">{{ animal.pelaje }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Sexo</label>
          <p class="text-lg text-gray-900">{{ animal.sexo }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Raza</label>
          <p class="text-lg text-gray-900">{{ animal.raza || 'N/A' }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Fecha de Nacimiento</label>
          <p class="text-lg text-gray-900">{{ formatDate(animal.fechaNacimiento) }}</p>
        </div>
      </div>
    </div>

    <!-- Informaci贸n Adicional -->
    <div class="card">
      <h3 class="text-xl font-semibold mb-4 text-neutral-dark">Informaci贸n Adicional</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">Descripci贸n</label>
          <p class="text-gray-900 whitespace-pre-wrap">{{ animal.descripcion || 'Sin descripci贸n' }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">ID</label>
          <p class="text-sm text-gray-600 font-mono break-all">{{ animal.id }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">ID Madre</label>
          <p class="text-sm text-gray-600 font-mono">{{ animal.idMadre || 'N/A' }}</p>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-500 mb-1">ID Padre</label>
          <p class="text-sm text-gray-600 font-mono">{{ animal.idPadre || 'N/A' }}</p>
        </div>

        <div *ngIf="animal.createdAt">
          <label class="block text-sm font-medium text-gray-500 mb-1">Fecha de Registro</label>
          <p class="text-gray-900">{{ formatDate(animal.createdAt) }}</p>
        </div>

        <div *ngIf="animal.updatedAt">
          <label class="block text-sm font-medium text-gray-500 mb-1">ltima Actualizaci贸n</label>
          <p class="text-gray-900">{{ formatDate(animal.updatedAt) }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="flex gap-3 flex-wrap">
    <button (click)="editAnimal()" class="btn-primary">
      Editar Animal
    </button>
    <button (click)="goBack()" class="btn-secondary">
      Ver Relaciones Familiares
    </button>
    <button (click)="openVaccinationModal()" class="btn-secondary bg-green-600 hover:bg-green-700">
      + Vacunaci贸n
    </button>
    <button (click)="openStateModal()" class="btn-secondary bg-yellow-600 hover:bg-yellow-700">
      + Estado
    </button>
    <button *ngIf="animal?.sexo === 'Hembra'" (click)="openBirthModal()" class="btn-secondary bg-purple-600 hover:bg-purple-700">
      + Parto
    </button>
    <button (click)="openHistoryModal()" class="btn-secondary bg-blue-600 hover:bg-blue-700">
      + Historial
    </button>
  </div>

  <!-- Historial del Animal -->
  <div class="card mt-6">
    <app-animal-history 
      [animalId]="animal.id"
      (editHistoryRequest)="onEditHistoryRequest($event)"
    ></app-animal-history>
  </div>
</div>

<!-- Modales -->
<app-modal 
  [isOpen]="isVaccinationModalOpen" 
  [title]="'Registrar Vacunaci贸n'" 
  (close)="closeModals()"
>
  <app-vaccination-form
    *ngIf="animal"
    [animalId]="animal.id"
    mode="create"
    (save)="onSaveVaccination($event)"
    (cancel)="closeModals()"
  ></app-vaccination-form>
</app-modal>

<app-modal 
  [isOpen]="isStateModalOpen" 
  [title]="'Registrar Estado'" 
  (close)="closeModals()"
>
  <app-animal-state-form
    *ngIf="animal"
    [animalId]="animal.id"
    mode="create"
    (save)="onSaveState($event)"
    (cancel)="closeModals()"
  ></app-animal-state-form>
</app-modal>

<app-modal 
  [isOpen]="isBirthModalOpen" 
  [title]="'Registrar Parto'" 
  (close)="closeModals()"
>
  <app-birth-form
    *ngIf="animal"
    [animalId]="animal.id"
    mode="create"
    (save)="onSaveBirth($event)"
    (cancel)="closeModals()"
  ></app-birth-form>
</app-modal>

<app-modal 
  [isOpen]="isHistoryModalOpen" 
  [title]="editingHistoryId ? 'Editar Historial' : 'Agregar al Historial'" 
  (close)="closeModals()"
>
  <app-history-form
    *ngIf="animal"
    [animalId]="animal.id"
    [historyId]="editingHistoryId"
    [existingHistory]="editingHistoryData"
    (save)="onSaveHistory($event)"
    (cancel)="closeModals()"
  ></app-history-form>
</app-modal>

<app-modal 
  [isOpen]="isEditModalOpen" 
  [title]="'Editar Animal'" 
  (close)="closeModals()"
>
  <app-animal-form
    *ngIf="animal"
    [animal]="animal"
    [pelajes]="(pelajes$ | async) || []"
    [duenos]="possibleOwners"
    (save)="onSaveEdit($event)"
    (cancel)="closeModals()"
  ></app-animal-form>
</app-modal>

<div *ngIf="loading" class="flex justify-center items-center h-64">
  <div class="text-gray-500">Cargando...</div>
</div>

<div *ngIf="!loading && !animal" class="card">
  <p class="text-center text-gray-500">Animal no encontrado.</p>
</div>

