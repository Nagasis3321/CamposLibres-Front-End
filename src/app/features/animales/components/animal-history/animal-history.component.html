<div class="space-y-4">
  <div class="flex items-center justify-between">
    <h3 class="text-xl font-semibold text-neutral-dark">Historial del Animal</h3>
    <button 
      (click)="loadHistory()" 
      class="btn-secondary text-sm"
      [disabled]="loading"
    >
      Actualizar
    </button>
  </div>

  <div *ngIf="loading" class="flex justify-center items-center py-8">
    <div class="text-gray-500">Cargando historial...</div>
  </div>

  <div *ngIf="!loading && historyItems.length === 0" class="card text-center py-8">
    <p class="text-gray-500">No hay registros en el historial de este animal.</p>
  </div>

  <div *ngIf="!loading && historyItems.length > 0" class="space-y-3">
    <div 
      *ngFor="let item of historyItems" 
      class="card border-l-4"
      [class.border-blue-500]="item.tipo === 'HISTORIAL'"
      [class.border-green-500]="item.tipo === 'VACUNACION'"
      [class.border-yellow-500]="item.tipo === 'ESTADO'"
      [class.border-purple-500]="item.tipo === 'PARTO'"
    >
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <div class="flex items-center gap-2 mb-2">
            <span 
              class="px-2 py-1 rounded text-xs font-semibold"
              [ngClass]="getTipoColor(item.tipo)"
            >
              {{ getTipoLabel(item.tipo) }}
            </span>
            <h4 class="text-lg font-semibold text-neutral-dark">{{ item.titulo }}</h4>
          </div>

          <div class="text-sm text-gray-600 space-y-1">
            <p><strong>Fecha:</strong> {{ formatDate(item.fecha) }}</p>
            <p *ngIf="item.usuario">
              <strong>Registrado por:</strong> {{ item.usuario.nombre }}
            </p>
            <p *ngIf="item.descripcion" class="mt-2 text-gray-700">
              {{ item.descripcion }}
            </p>

            <!-- Información adicional según el tipo -->
            <div *ngIf="item.tipo === 'VACUNACION' && item.data" class="mt-2 space-y-1">
              <p *ngIf="item.data.lote"><strong>Lote:</strong> {{ item.data.lote }}</p>
              <p *ngIf="item.data.veterinario">
                <strong>Veterinario:</strong> {{ item.data.veterinario }}
              </p>
            </div>

            <div *ngIf="item.tipo === 'ESTADO' && item.data" class="mt-2 space-y-1">
              <p>
                <strong>Estado:</strong> {{ item.data.tipo }}
                <span *ngIf="item.data.activo" class="ml-2 text-green-600 font-semibold">
                  (Activo)
                </span>
              </p>
              <p *ngIf="item.data.fechaFin">
                <strong>Fecha fin:</strong> {{ formatDate(item.data.fechaFin) }}
              </p>
            </div>

            <div *ngIf="item.tipo === 'PARTO' && item.data" class="mt-2 space-y-1">
              <p *ngIf="item.data.sexCria">
                <strong>Sexo cría:</strong> {{ item.data.sexCria }}
              </p>
              <p *ngIf="item.data.peso">
                <strong>Peso:</strong> {{ item.data.peso }}
              </p>
            </div>
          </div>
        </div>
        
        <!-- Botón de editar solo para tipo HISTORIAL -->
        <div *ngIf="item.tipo === 'HISTORIAL'" class="ml-4">
          <button 
            (click)="editHistory(item)" 
            class="text-blue-600 hover:text-blue-800 font-semibold text-sm"
          >
            Editar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

