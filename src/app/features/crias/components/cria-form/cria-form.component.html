<form [formGroup]="criaForm" (ngSubmit)="onSubmit()" class="flex flex-col max-h-[75vh]">
  <!-- Contenedor de campos con scroll vertical -->
  <div class="overflow-y-auto flex-grow pr-2 space-y-6">
    <fieldset class="p-4 border rounded-md space-y-2">
      <legend class="px-2 font-semibold">Datos de la Madre</legend>
      <div class="flex flex-col sm:flex-row sm:items-start sm:space-x-2 gap-2">
        <div class="flex-grow">
          <label for="caravanaMadre" class="text-sm font-medium">Buscar por Caravana (o dejar vacío)</label>
          <input id="caravanaMadre" type="text" formControlName="caravanaMadre" class="mt-1 w-full border border-gray-300 rounded-md p-2">
        </div>
        <button type="button" (click)="buscarMadre()" class="btn-secondary w-full sm:w-auto sm:mt-6">Buscar</button>
      </div>

      <div *ngIf="madreEncontrada" class="p-2 bg-green-100 text-green-800 text-sm rounded-md">
        Madre seleccionada: <strong>{{ madreEncontrada.caravana }}</strong> - {{ madreEncontrada.pelaje }}
      </div>
      <div *ngIf="errorBusquedaMadre" class="p-2 bg-red-100 text-danger text-sm rounded-md">
        {{ errorBusquedaMadre }}
      </div>

      <div *ngIf="posiblesMadres.length > 0" class="mt-2 border-t pt-2">
        <p class="text-sm font-medium mb-2">Seleccione una madre de la lista:</p>
        <div class="max-h-48 overflow-y-auto space-y-1 pr-2">
          <div *ngFor="let madre of posiblesMadres" 
               (click)="seleccionarMadre(madre)"
               class="p-2 hover:bg-primary-light hover:text-white cursor-pointer rounded-md text-sm border">
            <strong>Caravana: {{ madre.caravana || 'S/C' }}</strong> - {{ madre.pelaje }} (Dueño: {{ madre.dueno }})
          </div>
        </div>
      </div>
    </fieldset>

    <fieldset class="p-4 border rounded-md">
      <legend class="px-2 font-semibold">Datos de la Cría</legend>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
        <div>
          <label for="caravana" class="text-sm font-medium">Caravana (Opcional)</label>
          <input id="caravana" type="text" formControlName="caravana" class="mt-1 w-full border border-gray-300 rounded-md p-2">
        </div>
        <div>
          <label for="pelajeCria" class="text-sm font-medium">Pelaje</label>
          <input id="pelajeCria" type="text" formControlName="pelaje" list="pelajes-list-cria" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
          <datalist id="pelajes-list-cria">
            <option *ngFor="let pelaje of pelajes" [value]="pelaje"></option>
          </datalist>
        </div>
        <div>
          <label for="sexo" class="text-sm font-medium">Sexo</label>
          <select id="sexo" formControlName="sexo" class="mt-1 w-full border border-gray-300 rounded-md p-2">
            <option>Hembra</option>
            <option>Macho</option>
          </select>
        </div>
        <div>
          <label for="fechaNacimiento" class="text-sm font-medium">Fecha de Nacimiento</label>
          <input id="fechaNacimiento" type="date" formControlName="fechaNacimiento" class="mt-1 w-full border border-gray-300 rounded-md p-2">
        </div>
        <div class="md:col-span-2">
          <label for="descripcion" class="text-sm font-medium">Descripción</label>
          <textarea id="descripcion" formControlName="descripcion" rows="2" class="mt-1 w-full border border-gray-300 rounded-md p-2"></textarea>
        </div>
      </div>
    </fieldset>
  </div>

  <!-- Contenedor de botones fijo en la parte inferior -->
  <div class="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-3 gap-2 pt-4 mt-auto flex-shrink-0">
    <button type="button" (click)="cancel.emit()" class="btn-secondary w-full sm:w-auto">Cancelar</button>
    <button type="submit" [disabled]="criaForm.invalid" class="btn-primary disabled:opacity-50 w-full sm:w-auto">Guardar Cría</button>
  </div>
</form>