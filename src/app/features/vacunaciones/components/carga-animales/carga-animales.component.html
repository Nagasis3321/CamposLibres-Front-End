<!-- Overlay para el fondo oscuro -->
<div class="modal-overlay" (click)="cancel.emit()"></div>

<!-- Contenedor principal del formulario -->
<div class="form-container-large">
  <div class="form-header">
    <h2>Cargar Animales: {{ campana?.nombreCampana }}</h2>
    <button (click)="cancel.emit()" class="btn-close">&times;</button>
  </div>

  <!-- Cuerpo del formulario con scroll interno -->
  <div class="form-body">
    <!-- Columna de Búsqueda -->
    <div class="columna-busqueda">
      <h4 class="font-semibold">1. Buscar Animales</h4>
      <form [formGroup]="searchForm" class="search-form">
        <div>
          <label>Caravana</label>
          <input formControlName="caravana" type="text" class="form-input">
        </div>
        <div class="autocomplete-container">
          <label>Pelaje</label>
          <input formControlName="pelaje" type="text" class="form-input" (focus)="mostrarSugerenciasPelaje = true" (blur)="mostrarSugerenciasPelaje = false">
          <div *ngIf="mostrarSugerenciasPelaje && (pelajesSugeridos$ | async) as sugerencias" class="suggestions-list">
            <div *ngFor="let pelaje of sugerencias" (mousedown)="seleccionarPelaje(pelaje)" class="suggestion-item">
              {{ pelaje }}
            </div>
          </div>
        </div>
        <div>
          <label>Tipo</label>
          <select formControlName="tipoAnimal" class="form-input">
            <option value="">Todos</option>
            <option>Vaca</option>
            <option>Vaquilla</option>
            <option>Ternero/a</option>
            <option>Novillo</option>
            <option>Toro</option>
          </select>
        </div>
        <div>
          <label>Sexo</label>
          <select formControlName="sexo" class="form-input">
            <option value="">Todos</option>
            <option>Hembra</option>
            <option>Macho</option>
          </select>
        </div>
        <div class="col-span-2">
            <label>Dueño</label>
            <select formControlName="dueno" class="form-input">
                <option value="">Todos</option>
                <option *ngFor="let dueno of duenosUnicos" [value]="dueno">{{ dueno }}</option>
            </select>
        </div>
      </form>
      <div class="resultados-busqueda">
        <p class="resultados-titulo">Resultados (clic para agregar):</p>
        <div *ngFor="let animal of animalesDisponibles" (click)="agregarAnimal(animal)" class="resultado-item">
          <strong>{{ animal.caravana || 'S/C' }}</strong> - {{ animal.tipoAnimal }} - {{ animal.pelaje }} - {{ animal['dueno']|| 'Sin dueño' }}
        </div>
        <p *ngIf="animalesDisponibles.length === 0" class="no-resultados">No hay resultados.</p>
      </div>
    </div>
  
    <!-- Columna de Animales Agregados -->
    <div class="columna-agregados">
      <h4 class="font-semibold mb-4">2. Animales en Campaña ({{ animalesEnCampana.length }})</h4>
      <div class="lista-agregados">
        <div *ngFor="let animal of animalesEnCampana" class="agregado-item">
          <div class="info-animal">
            <strong>{{ animal.caravana || 'S/C' }}</strong>
            <span>{{ animal.tipoAnimal }} - {{ animal.pelaje }}</span>
            <span class="dueño-animal">{{ animal['dueno'] || 'Sin dueño' }}</span>
          </div>
          <button (click)="quitarAnimal(animal)" class="btn-quitar">Quitar</button>
        </div>
        <p *ngIf="animalesEnCampana.length === 0" class="no-resultados">Ningún animal agregado aún.</p>
      </div>
    </div>
  </div>

  <!-- Pie del formulario -->
  <div class="form-footer">
    <button type="button" (click)="cancel.emit()" class="btn-secondary">Cancelar</button>
    <button type="button" (click)="finalizarCarga()" class="btn-primary">Finalizar y Guardar Campaña</button>
  </div>
</div>
